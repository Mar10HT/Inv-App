<div class="bg-surface-variant rounded-xl max-h-[90vh] overflow-hidden flex flex-col">
  <!-- Loading State -->
  @if (loading()) {
    <div class="flex items-center justify-center py-24 px-12">
      <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-[#4d7c6f]"></div>
      <span class="ml-4 text-slate-400 text-lg">{{ 'COMMON.LOADING' | translate }}...</span>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="p-6">
      <div class="bg-rose-950/30 border border-rose-900 rounded-xl p-6">
        <div class="flex items-center gap-3 mb-4">
          <mat-icon class="!text-rose-400 !text-3xl">error</mat-icon>
          <span class="text-rose-400 text-lg">{{ error() }}</span>
        </div>
        <button
          (click)="close()"
          class="text-sky-400 hover:text-sky-300 transition-colors flex items-center gap-2">
          <mat-icon class="!text-base">close</mat-icon>
          {{ 'COMMON.CANCEL' | translate }}
        </button>
      </div>
    </div>
  }

  <!-- Item Detail -->
  @if (item(); as item) {
    <!-- Header -->
    <div class="p-6 border-b border-theme flex items-start justify-between gap-4">
      <div class="flex items-start gap-4 flex-1 min-w-0">
        <div class="w-14 h-14 bg-[#2d4a3f] rounded-xl flex items-center justify-center flex-shrink-0">
          <mat-icon class="!text-[#4d7c6f] !text-2xl">inventory_2</mat-icon>
        </div>
        <div class="min-w-0 flex-1">
          <h1 class="text-2xl font-bold text-slate-200 truncate">{{ item.name }}</h1>
          <p class="text-slate-500 mt-1 line-clamp-2">{{ item.description || ('ITEM_DETAIL.NO_DESCRIPTION' | translate) }}</p>

          <!-- Status Badge -->
          <div class="mt-3">
            <span
              [ngClass]="{
                'text-emerald-400 bg-emerald-950/50 border border-emerald-900': item.status === InventoryStatus.IN_STOCK,
                'text-orange-400 bg-orange-950/50 border border-orange-900': item.status === InventoryStatus.LOW_STOCK,
                'text-rose-400 bg-rose-950/50 border border-rose-900': item.status === InventoryStatus.OUT_OF_STOCK
              }"
              class="px-3 py-1.5 rounded-lg text-xs font-medium inline-flex items-center gap-1.5">
              @switch (item.status) {
                @case (InventoryStatus.IN_STOCK) {
                  <mat-icon class="!text-sm">check_circle</mat-icon>
                }
                @case (InventoryStatus.LOW_STOCK) {
                  <mat-icon class="!text-sm">warning</mat-icon>
                }
                @case (InventoryStatus.OUT_OF_STOCK) {
                  <mat-icon class="!text-sm">error</mat-icon>
                }
              }
              {{ getStatusKey(item.status) | translate }}
            </span>
          </div>
        </div>
      </div>

      <!-- Close Button -->
      <button
        (click)="close()"
        class="p-2 rounded-lg text-slate-500 hover:text-slate-300 hover:bg-[#2a2a2a] transition-colors flex-shrink-0">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Scrollable Content -->
    <div class="flex-1 overflow-y-auto p-6">
      <!-- Main Info Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <!-- Basic Info -->
        <div class="bg-[#141414] border border-[#1e1e1e] rounded-xl p-5">
          <h2 class="text-sm font-semibold text-slate-400 mb-4 flex items-center gap-2">
            <mat-icon class="!text-lg !text-slate-500">info</mat-icon>
            {{ 'ITEM_DETAIL.BASIC_INFO' | translate }}
          </h2>

          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-xs text-slate-500 uppercase">{{ 'ITEM_DETAIL.CATEGORY' | translate }}</span>
              <span class="text-slate-300 text-sm">{{ item.category }}</span>
            </div>

            <div class="flex justify-between">
              <span class="text-xs text-slate-500 uppercase">{{ 'ITEM_DETAIL.TYPE.LABEL' | translate }}</span>
              <span class="text-slate-300 text-sm">{{ getItemTypeKey(item.itemType) | translate }}</span>
            </div>

            @if (item.sku) {
              <div class="flex justify-between">
                <span class="text-xs text-slate-500 uppercase">{{ 'COMMON.SKU' | translate }}</span>
                <span class="text-slate-300 text-sm font-mono">{{ item.sku }}</span>
              </div>
            }

            @if (item.barcode) {
              <div class="flex justify-between">
                <span class="text-xs text-slate-500 uppercase">{{ 'ITEM_DETAIL.BARCODE' | translate }}</span>
                <span class="text-slate-300 text-sm font-mono">{{ item.barcode }}</span>
              </div>
            }

            @if (item.serialNumber) {
              <div class="flex justify-between">
                <span class="text-xs text-slate-500 uppercase">{{ 'ITEM_DETAIL.SERIAL_NUMBER' | translate }}</span>
                <span class="text-slate-300 text-sm font-mono">{{ item.serialNumber }}</span>
              </div>
            }

            @if (item.serviceTag) {
              <div class="flex justify-between">
                <span class="text-xs text-slate-500 uppercase">{{ 'ITEM_DETAIL.SERVICE_TAG' | translate }}</span>
                <span class="text-slate-300 text-sm font-mono">{{ item.serviceTag }}</span>
              </div>
            }
          </div>
        </div>

        <!-- Stock & Price -->
        <div class="bg-[#141414] border border-[#1e1e1e] rounded-xl p-5">
          <h2 class="text-sm font-semibold text-slate-400 mb-4 flex items-center gap-2">
            <mat-icon class="!text-lg !text-slate-500">inventory</mat-icon>
            {{ 'ITEM_DETAIL.STOCK_PRICE' | translate }}
          </h2>

          <div class="space-y-3">
            <div class="flex items-center justify-between p-3 bg-surface-variant rounded-lg">
              <div>
                <p class="text-xs text-slate-500 uppercase">{{ 'ITEM_DETAIL.QUANTITY' | translate }}</p>
                <p class="text-2xl font-bold text-slate-200">{{ item.quantity }}</p>
              </div>
              <div class="text-right">
                <p class="text-xs text-slate-500 uppercase">{{ 'ITEM_DETAIL.MIN_QUANTITY' | translate }}</p>
                <p class="text-lg font-semibold text-slate-400">{{ item.minQuantity }}</p>
              </div>
            </div>

            <div class="flex justify-between">
              <span class="text-xs text-slate-500 uppercase">{{ 'ITEM_DETAIL.UNIT_PRICE' | translate }}</span>
              <span class="text-lg font-bold text-[#4d7c6f]">{{ formatCurrency(item.price, item.currency) }}</span>
            </div>

            @if (item.price) {
              <div class="flex justify-between">
                <span class="text-xs text-slate-500 uppercase">{{ 'ITEM_DETAIL.TOTAL_VALUE' | translate }}</span>
                <span class="text-slate-300 font-semibold">{{ formatCurrency(item.price * item.quantity, item.currency) }}</span>
              </div>
            }
          </div>
        </div>
      </div>

      <!-- Location & Supplier -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <!-- Warehouse -->
        <div class="bg-[#141414] border border-[#1e1e1e] rounded-xl p-5">
          <h2 class="text-sm font-semibold text-slate-400 mb-4 flex items-center gap-2">
            <mat-icon class="!text-lg !text-slate-500">warehouse</mat-icon>
            {{ 'ITEM_DETAIL.WAREHOUSE' | translate }}
          </h2>

          @if (item.warehouse) {
            <div class="space-y-2">
              <p class="text-slate-300 font-medium">{{ item.warehouse.name }}</p>
              <p class="text-slate-500 text-sm">{{ item.warehouse.location }}</p>
              @if (item.warehouse.description) {
                <p class="text-slate-600 text-xs">{{ item.warehouse.description }}</p>
              }
            </div>
          } @else {
            <p class="text-slate-600 text-sm">{{ 'ITEM_DETAIL.NO_WAREHOUSE' | translate }}</p>
          }
        </div>

        <!-- Supplier -->
        <div class="bg-[#141414] border border-[#1e1e1e] rounded-xl p-5">
          <h2 class="text-sm font-semibold text-slate-400 mb-4 flex items-center gap-2">
            <mat-icon class="!text-lg !text-slate-500">local_shipping</mat-icon>
            {{ 'ITEM_DETAIL.SUPPLIER' | translate }}
          </h2>

          @if (item.supplier) {
            <div class="space-y-2">
              <p class="text-slate-300 font-medium">{{ item.supplier.name }}</p>
              <p class="text-slate-500 text-sm">{{ item.supplier.location }}</p>
              @if (item.supplier.email) {
                <p class="text-sky-400 text-sm">{{ item.supplier.email }}</p>
              }
              @if (item.supplier.phone) {
                <p class="text-slate-500 text-sm">{{ item.supplier.phone }}</p>
              }
            </div>
          } @else {
            <p class="text-slate-600 text-sm">{{ 'ITEM_DETAIL.NO_SUPPLIER' | translate }}</p>
          }
        </div>
      </div>

      <!-- Assignment (for UNIQUE items) -->
      @if (item.itemType === ItemType.UNIQUE && item.assignedToUser) {
        <div class="bg-[#141414] border border-[#1e1e1e] rounded-xl p-5 mb-4">
          <h2 class="text-sm font-semibold text-slate-400 mb-4 flex items-center gap-2">
            <mat-icon class="!text-lg !text-slate-500">person</mat-icon>
            {{ 'ITEM_DETAIL.ASSIGNMENT' | translate }}
          </h2>

          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-sky-950/50 rounded-full flex items-center justify-center">
              <mat-icon class="!text-sky-400 !text-lg">person</mat-icon>
            </div>
            <div>
              <p class="text-slate-300 font-medium">{{ item.assignedToUser.name || item.assignedToUser.email }}</p>
              <p class="text-slate-500 text-sm">{{ item.assignedToUser.email }}</p>
              @if (item.assignedAt) {
                <p class="text-slate-600 text-xs mt-1">{{ 'ITEM_DETAIL.ASSIGNED_ON' | translate }}: {{ formatDate(item.assignedAt) }}</p>
              }
            </div>
          </div>
        </div>
      }

      <!-- Timestamps -->
      <div class="flex flex-wrap gap-4 text-xs text-slate-600">
        <div class="flex items-center gap-1">
          <mat-icon class="!text-sm">add_circle</mat-icon>
          <span>{{ 'ITEM_DETAIL.CREATED' | translate }}: {{ formatDate(item.createdAt) }}</span>
        </div>
        <div class="flex items-center gap-1">
          <mat-icon class="!text-sm">update</mat-icon>
          <span>{{ 'ITEM_DETAIL.UPDATED' | translate }}: {{ formatDate(item.updatedAt) }}</span>
        </div>
        @if (item.createdBy) {
          <div class="flex items-center gap-1">
            <mat-icon class="!text-sm">person</mat-icon>
            <span>{{ 'ITEM_DETAIL.CREATED_BY' | translate }}: {{ item.createdBy.name || item.createdBy.email }}</span>
          </div>
        }
      </div>
    </div>

    <!-- Footer Actions -->
    <div class="p-4 border-t border-theme flex items-center justify-end gap-3">
      <button
        (click)="close()"
        class="px-4 py-2 rounded-lg text-slate-400 hover:text-slate-300 hover:bg-[#2a2a2a] transition-colors">
        {{ 'COMMON.CANCEL' | translate }}
      </button>
      <button
        (click)="deleteItem()"
        class="px-4 py-2 rounded-lg text-rose-400 border border-rose-900 hover:bg-rose-950/30 transition-colors flex items-center gap-2">
        <mat-icon class="!text-lg">delete</mat-icon>
        {{ 'COMMON.DELETE' | translate }}
      </button>
      <button
        (click)="editItem()"
        class="px-4 py-2 rounded-lg bg-[#4d7c6f] text-white hover:bg-[#5d8c7f] transition-colors flex items-center gap-2">
        <mat-icon class="!text-lg">edit</mat-icon>
        {{ 'COMMON.EDIT' | translate }}
      </button>
    </div>
  }
</div>
